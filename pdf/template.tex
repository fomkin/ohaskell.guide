% Строим книгу.
\documentclass[$if(fontsize)$$fontsize$$endif$,oneside]{book}

% Задаём русский и моноширинный шрифты.
\usepackage{fontspec}
\defaultfontfeatures{Ligatures=TeX}
\setmainfont{PT Serif}
\setsansfont{PT Sans}
\setmonofont[Scale=0.9]{Ubuntu Mono}

% Поддержка русского языка с переносами.
\usepackage{polyglossia}
\setdefaultlanguage[]{russian}
\setmainlanguage[]{russian}
\setotherlanguage[]{english}
\newfontfamily\cyrillicfont{PT Serif}

% Для красивых колонтитулов.
\usepackage{fancyhdr}

% Абзацы без горизонтального отступа, но с вертиальным отступом.
\usepackage[parfill]{parskip}

% Задаём метаданные и характеристики гиперссылок.
\usepackage{hyperref}
\PassOptionsToPackage{usenames,dvipsnames}{color} % color is loaded by hyperref
\hypersetup{unicode=true,
            pdftitle={О Haskell по-человечески},
            pdfauthor={Денис Шевченко},
            pdfsubject={Ваша первая книга о языке программирования Haskell},
            colorlinks=true,
            linkcolor=Maroon,
            citecolor=Blue,
            urlcolor=Blue,
            pdfborder={0 0 0},
            breaklinks=true}
% Шрифт гиперссылок не моноширинный.
\urlstyle{same}

\setlength{\emergencystretch}{3em}  % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}

\usepackage{color}
\usepackage{fancyvrb}
\VerbatimFootnotes % allows verbatim text in footnotes

% Определяем синтаксическую подсветку для примеров исходного кода.
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\},baselinestretch=0.9,samepage=true,frame=single,rulecolor=\color{white},framesep=3mm}
\newenvironment{Shaded}{}{}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.56,0.13,0.00}{{#1}}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.53,0.00,0.00}{{#1}}}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.73,0.40,0.53}{{#1}}}
\newcommand{\ImportTok}[1]{{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textit{{#1}}}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.73,0.13,0.13}{\textit{{#1}}}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{{#1}}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.02,0.16,0.49}{{#1}}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.10,0.09,0.49}{{#1}}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.40,0.40,0.40}{{#1}}}
\newcommand{\BuiltInTok}[1]{{#1}}
\newcommand{\ExtensionTok}[1]{{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.74,0.48,0.00}{{#1}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.49,0.56,0.16}{{#1}}}
\newcommand{\RegionMarkerTok}[1]{{#1}}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
\newcommand{\NormalTok}[1]{{#1}}

% Задаём формат страницы и все отступы.
\usepackage[$for(geometry)$$geometry$$sep$,$endfor$]{geometry}

% Для увеличенного интерлиньяжа.
\usepackage{setspace}

\usepackage{textcomp}

% Для вставки полноразмерных PDF-страниц без полей.
\usepackage{pdfpages}

% Титульная страница книги.
\newcommand*{\ohaskelltitle}{\begingroup
\newlength{\drop} % Command for generating a specific amount of whitespace
\drop=0.1\textheight % Define the command as 10% of the total text height

\vspace{\drop} % Whitespace between the top lines and title
\centering % Center all text
%\textcolor{MidnightBlue}{ % Red font color
{\Huge О Haskell по-человечески}\\[0.5\baselineskip] % Title line 1
\vspace{15pt}
{\Large издание 2.0}
%} % Title line 3

\vspace{0.25\drop}
\rule{0.3\textwidth}{0.4pt}\par
\vspace{\drop}

{\large \textsc{Денис Шевченко}}\par

\vfill
{\large \textsc{www.ohaskell.guide}}\par
{\Large \textsc{2016}}\par
\endgroup}

% Вторая страница, со ссылкой на лицензию CC.
\newcommand*{\ohaskelllicense}{\begingroup
\vspace*{\fill}
\centering
{\large \textsc{Книга свободно распространяется на условиях лицензии \href{http://creativecommons.org/licenses/by-nc/4.0/deed.ru}{CC BY-NC 4.0}}}\par
{\footnotesize \textsc{\textcopyright \enspace Денис Шевченко, 2014-2016}}\par
\vspace*{\fill}
\endgroup}

\begin{document}

% Обложка.
\includepdf{pdf/cover.pdf}

% Титульная и лицензионная страницы - без нумерации.
\pagestyle{empty}
\ohaskelltitle
\newpage
\pagestyle{empty}
\ohaskelllicense

% Устанавливаем цвет ссылок в Оглавлении.
\hypersetup{linkcolor=black}
% Части глав не нумеруются, только главы.
\setcounter{secnumdepth}{0}
\setcounter{tocdepth}{1}
\pagestyle{empty}
% Двойной интерлиньяж для пунктов в Оглавлении.
\doublespacing
\tableofcontents
% Возвращаем нормальный интерлиньяж.
\singlespacing
\thispagestyle{empty}
\clearpage

% Устанавливаем колонтитулы (в данном случае используется только верхний).
\pagestyle{fancy}
\fancyhf{}
% В верхнем левом углу - название текущей главы.
\fancyhead[L]{\fontsize{10}{12} \selectfont \rmfamily{\nouppercase\leftmark}}
% В верхнем правом углу - номер текущей страницы.
\fancyhead[R]{\fontsize{10}{12} \selectfont \rmfamily{\thepage}}

$body$

\end{document}

